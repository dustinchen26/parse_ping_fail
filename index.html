<!-- 
  Copyright © [2023] [Dustin_Chen]. All rights reserved.
  Author: Dustin_Chen
  Email:  Dustin_Chen@compal.com or chuhpsdustin@gmail.com

-->
<!DOCTYPE html>
<html>
<head>
    <title>parse_ping_fail</title>
    <style>
    body {
      font-family: 'Roboto', sans-serif;
      line-height: 1.2;
      font-size: 14px;
    }

    table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
        padding: 5px;
    }
    .highlight {
        color: red;
    }

    /* 增大输入框的CSS */
    #input {
        width: 55%;
        height: 120px; 
    }
    </style>
</head>
<body>
    <h2>parse_ping_fail</h2>

    <p style="margin: 0;">Author: Dustin_Chen, email: <a href="mailto:Dustin_Chen@compal.com"
        style="line-height: 1;">Dustin_Chen@compal.com</a> or <a href="mailto:chuhpsdustin@gmail.com"
        style="line-height: 1;">chuhpsdustin@gmail.com</a></p>    

    <p>EX: paste the result of: ping 10.205.164.5 -t | while read pong; do echo "$(date): $pong"; done</p>

    <textarea id="input"></textarea><br><br>
    <button onclick="parseInput()">解析</button>
    <h2>結果</h2>
    <table>
        <thead>
            <tr>
                <th>Time1 (Request timed out)</th>
                <th>Time2 (Reply from)</th>
                <th>Time3 (秒)</th>
            </tr>
        </thead>
        <tbody id="output"></tbody>
    </table>

    <script>
        function parseInput() {
            const input = document.getElementById("input").value;
            const lines = input.split('\n');
            const outputLines = [];
            let time1 = null;
            let time2 = null;

            for (const line of lines) {
                const timeString = line.substring(0, 24).trim();
                const timestamp = new Date(timeString);

                if (!time1 && line.includes("Request timed out.")) {
                    time1 = timestamp;
                } else if (time1 && line.includes("Reply from")) {
                    time2 = timestamp;
                    const time3 = (time2 - time1) / 1000; // Calculate the difference in seconds
                    if (time3 > 1) {
                        outputLines.push(`<tr class="highlight"><td>${time1.toTimeString().split(' ')[0]}</td><td>${time2.toTimeString().split(' ')[0]}</td><td>${time3}</td></tr>`);
                    }
                    time1 = null;
                }
            }

            document.getElementById("output").innerHTML = outputLines.join('');
        }
    </script>
</body>
</html>
